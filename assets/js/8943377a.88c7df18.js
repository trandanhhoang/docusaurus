"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1982],{162:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=s(5893),t=s(1151);const i={sidebar_position:4},o="V\xed d\u1ee5 liquibase - database version control",l={id:"java-springboot/liquibase-set-up",title:"V\xed d\u1ee5 liquibase - database version control",description:"T\xf3m t\u1eaft",source:"@site/docs/java-springboot/liquibase-set-up.md",sourceDirName:"java-springboot",slug:"/java-springboot/liquibase-set-up",permalink:"/docs/java-springboot/liquibase-set-up",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"V\xed d\u1ee5 kafka + java springboot",permalink:"/docs/java-springboot/kafka-with-java-springboot-example"},next:{title:"T\u1ed1i \u01b0u query jdbc khi migration database",permalink:"/docs/java-springboot/optimize-jdbc-query-when-migration-database"}},r={},c=[{value:"T\xf3m t\u1eaft",id:"t\xf3m-t\u1eaft",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Code example",id:"code-example",level:2},{value:"Gi\u1ea3i th\xedch chi ti\u1ebft",id:"gi\u1ea3i-th\xedch-chi-ti\u1ebft",level:2},{value:"<strong>Database Changelog and Database Changelog Lock</strong>",id:"database-changelog-and-database-changelog-lock",level:3},{value:"C\xe2u h\u1ecfi t\u1ef1 tr\u1ea3 l\u1eddi",id:"c\xe2u-h\u1ecfi-t\u1ef1-tr\u1ea3-l\u1eddi",level:2},{value:"References",id:"references",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"v\xed-d\u1ee5-liquibase---database-version-control",children:"V\xed d\u1ee5 liquibase - database version control"}),"\n",(0,a.jsx)(n.h2,{id:"t\xf3m-t\u1eaft",children:"T\xf3m t\u1eaft"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"project springboot v\u1edbi database postgresql, s\u1eed d\u1ee5ng liquibase \u0111\u1ec3 qu\u1ea3n l\xfd version c\u1ee7a database."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.liquibase.com/home.html",children:"https://docs.liquibase.com/home.html"})}),"\n",(0,a.jsx)(n.li,{children:"Docker, Docker compose"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"code-example",children:"Code example"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"file Dockercompose.yaml"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"version: '3.8'\nname: liquibase-self-learn\nservices:\n  postgres:\n    image: postgres:15.5-alpine\n    restart: always\n    ports:\n      - \"5432:5432\"\n    environment:\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: postgres\n    volumes:\n      - local-postgres-v15:/var/lib/postgresql/data\nvolumes:\n  local-postgres-v15:\n    external: true\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"file build.gradle"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"dependencies {\n    implementation 'org.springframework.boot:spring-boot-starter'\n    implementation 'org.liquibase:liquibase-core'\n    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'\n    implementation 'org.postgresql:postgresql'\n\n    compileOnly 'org.projectlombok:lombok'\n\n    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'\n    annotationProcessor 'org.projectlombok:lombok'\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"file application.yml"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'spring:\n  liquibase:\n    url: jdbc:postgresql://localhost:5432/${DATABASE_NAME:hoang-test-liquibase}\n    user: postgres\n    password: postgres\n    change-log: "classpath:db/changelog/changelog-master.xml"\n  datasource:\n    url: jdbc:postgresql://localhost:5432/${DATABASE_NAME:hoang-test-liquibase}\n    username: postgres\n    password: postgres\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"file resouces/db/changelog/changelog-master.xml"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<databaseChangeLog\n        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"\n        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.7.xsd"\n>\n    <changeSet author="hoang.tran" id="init_database">\n        <sql>\n            CREATE TABLE IF NOT EXISTS hoang_s_table\n            (\n                id                         BIGSERIAL PRIMARY KEY,\n                transaction_id             VARCHAR(50) NOT NULL\n                );\n        </sql>\n    </changeSet>\n\n    <changeSet author="huy.loc" id="extend_card_number_length">\n        <sql>\n            ALTER TABLE hoang_s_table\n            ADD name VARCHAR(20);\n        </sql>\n    </changeSet>\n</databaseChangeLog>\n'})}),"\n",(0,a.jsx)(n.h2,{id:"gi\u1ea3i-th\xedch-chi-ti\u1ebft",children:"Gi\u1ea3i th\xedch chi ti\u1ebft"}),"\n",(0,a.jsx)(n.h3,{id:"database-changelog-and-database-changelog-lock",children:(0,a.jsx)(n.strong,{children:"Database Changelog and Database Changelog Lock"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Khi b\u1ea1n t\u1ea1o thay \u0111\u1ed5i,Liquibase s\u1ebd t\u1ea1o 2 b\u1ea3ng Database Changelog, Database Changelog Lock","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The DATABASECHANGELOG table tracks deployed changes so that you have a record. Liquibase compares the changesets in the changelog file with the DATABASECHANGELOG tracking table and deploys only new changesets."}),"\n",(0,a.jsx)(n.li,{children:"DATABASECHANGELOGLOCK prevents multiple instances of Liquibase from updating the database at the same time. The table manages access to the DATABASECHANGELOG table during deployment and ensures only one instance of Liquibase is updating the database."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"c\xe2u-h\u1ecfi-t\u1ef1-tr\u1ea3-l\u1eddi",children:"C\xe2u h\u1ecfi t\u1ef1 tr\u1ea3 l\u1eddi"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Th\xeam 1 changSet m\u1edbi v\xe0 ch\u1ea1y th\u1eed."}),"\n",(0,a.jsx)(n.li,{children:"Thay \u0111\u1ed5i changeSet c\u0169 v\xe0 ch\u1ea1y th\u1eed, c\xf3 g\xec x\u1ea3y ra ?"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.liquibase.com/home.html",children:"https://docs.liquibase.com/home.html"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>o});var a=s(7294);const t={},i=a.createContext(t);function o(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);