"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[22],{675:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>t,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var i=r(5893),o=r(1151);const a={sidebar_position:1},t="V\xed d\u1ee5 kafka + java springboot",s={id:"java/kafka-with-java-springboot-example",title:"V\xed d\u1ee5 kafka + java springboot",description:"T\xf3m t\u1eaft",source:"@site/docs/java/kafka-with-java-springboot-example.md",sourceDirName:"java",slug:"/java/kafka-with-java-springboot-example",permalink:"/docs/java/kafka-with-java-springboot-example",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Java",permalink:"/docs/category/java"},next:{title:"Kafka - c\xe1c kh\xe1i ni\u1ec7m c\u01a1 b\u1ea3n",permalink:"/docs/kafka/kafka-basic"}},c={},l=[{value:"T\xf3m t\u1eaft",id:"t\xf3m-t\u1eaft",level:2},{value:"Prequisites",id:"prequisites",level:2},{value:"Set up",id:"set-up",level:2},{value:"Example code",id:"example-code",level:2},{value:"Producer project",id:"producer-project",level:3},{value:"Consumer project",id:"consumer-project",level:3},{value:"build.gradle",id:"buildgradle",level:3},{value:"Run and learn",id:"run-and-learn",level:2},{value:"Consumer + partition ho\u1ea1t \u0111\u1ed9ng v\u1edbi nhau nh\u01b0 th\u1ebf n\xe0o ?",id:"consumer--partition-ho\u1ea1t-\u0111\u1ed9ng-v\u1edbi-nhau-nh\u01b0-th\u1ebf-n\xe0o-",level:3},{value:"Consumer, ack tr\xean t\u1eebng partition ho\u1ea1t \u0111\u1ed9ng nh\u01b0 th\u1ebf n\xe0o ?",id:"consumer-ack-tr\xean-t\u1eebng-partition-ho\u1ea1t-\u0111\u1ed9ng-nh\u01b0-th\u1ebf-n\xe0o-",level:3},{value:"C\xe2u h\u1ecfi t\u1ef1 tr\u1ea3 l\u1eddi",id:"c\xe2u-h\u1ecfi-t\u1ef1-tr\u1ea3-l\u1eddi",level:2},{value:"References",id:"references",level:2}];function p(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"v\xed-d\u1ee5-kafka--java-springboot",children:"V\xed d\u1ee5 kafka + java springboot"}),"\n",(0,i.jsx)(e.h2,{id:"t\xf3m-t\u1eaft",children:"T\xf3m t\u1eaft"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"v\xed d\u1ee5 kafka producer, consumer c\u01a1 b\u1ea3n \u0111\u1ec3 hi\u1ec3u r\xf5 h\u01a1n v\u1ec1 partition, ack trong consumer."}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"prequisites",children:"Prequisites"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Kh\xe1i ni\u1ec7m c\u01a1 b\u1ea3n c\u1ee7a kafka ",(0,i.jsx)(e.a,{href:"https://trandanhhoang.github.io/docs/kafka/kafka-basic",children:"kafka-c\u01a1-b\u1ea3n"})]}),"\n",(0,i.jsxs)(e.li,{children:["Xem qua visualization \u0111\u1ec3 hi\u1ec3u r\xf5 h\u01a1n:","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://softwaremill.com/kafka-visualisation/",children:"https://softwaremill.com/kafka-visualisation/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"set-up",children:"Set up"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"file docker-compose.yaml"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"version: '3.8'\nname: kafka-self-learn\nservices:\n  zookeeper:\n    container_name: local-zookeeper\n    image: 'zookeeper:latest'\n    ports:\n      - '2181:2181'\n    environment:\n      - ZOOKEEPER_CLIENT_PORT=2181\n      - ALLOW_ANONYMOUS_LOGIN=yes\n  kafka:\n    container_name: local-kafka\n    image: 'bitnami/kafka:latest'\n    ports:\n      - '9092:9092'\n    environment:\n      - KAFKA_BROKER_ID=0\n      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181\n      - ALLOW_PLAINTEXT_LISTENER=yes\n      - KAFKA_CFG_INTER_BROKER_LISTENER_NAME=INTERNAL\n      - KAFKA_CFG_LISTENERS=PLAINTEXT_UI://:9091,PLAINTEXT://:9092,INTERNAL://kafka:9093\n      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT_UI://kafka:9091,PLAINTEXT://localhost:9092,INTERNAL://kafka:9093\n      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=INTERNAL:PLAINTEXT,PLAINTEXT:PLAINTEXT,PLAINTEXT_UI:PLAINTEXT\n    depends_on:\n      - zookeeper\n      \n  kafka-ui:\n    container_name: local-kafka-ui\n    image: 'provectuslabs/kafka-ui:latest'\n    ports:\n      - '9090:8080'\n    environment:\n      - DYNAMIC_CONFIG_ENABLED=true\n      - KAFKA_CLUSTERS_0_NAME=local\n      - KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka:9091\n      - KAFKA_CLUSTERS_0_ZOOKEEPER=zookeeper:2181\n    depends_on:\n      - kafka\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"B\u1ea1n c\xf3 th\u1ec3 d\xf9ng file docker-compose tr\xean, d\xf9ng kafka-ui \u0111\u1ec3 check status c\u1ee7a kafka-broker."}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"example-code",children:"Example code"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Bao g\u1ed3m 2 project l\xe0 consumer v\xe0 producer, producer \u0111\u01b0\u1ee3c code ri\xeang \u0111\u1ec3 qu\u1ea3n l\xfd vi\u1ec7c b\u1eafn message l\xean topic."}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"producer-project",children:"Producer project"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'package com.example.producerkafkatest;\n\nimport org.apache.kafka.clients.admin.NewTopic;\nimport org.springframework.boot.ApplicationRunner;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.kafka.config.TopicBuilder;\nimport org.springframework.kafka.core.KafkaTemplate;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class ProducerReactor {\n    @Bean\n    public NewTopic topic() {\n        return TopicBuilder.name("topic-reactor")\n                .partitions(10)\n                .replicas(1)\n                .build();\n    }\n\n    @Bean\n    public ApplicationRunner runnerPartition1(KafkaTemplate<String, String> templateDefault) {\n        return args -> {\n            // send 10 message\n            for (int messageNumber = 0; messageNumber < 10; messageNumber++) {\n                // send 10 partition\n                for (int partition = 0; partition < 10; partition++) {\n                    templateDefault.send("topic-reactor", partition, "hoang", "message number " + messageNumber);\n                }\n                Thread.sleep(1000);\n            }\n        };\n    }\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"consumer-project",children:"Consumer project"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'package com.example.kafkaselflearn.kafka.producer;\n\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.kafka.annotation.KafkaListener;\nimport org.springframework.stereotype.Component;\n\n@Component\n@Slf4j\npublic class Consumer {\n\n    @KafkaListener(id = "myId", topics = "topic1", concurrency = "2")\n    public void listen(String in) throws InterruptedException {\n        Thread.sleep(2000);\n        log.info("received message=\'{}\'", in);\n    }\n}\n\n'})}),"\n",(0,i.jsx)(e.h3,{id:"buildgradle",children:"build.gradle"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"dependencies {\n    implementation 'org.springframework.boot:spring-boot-starter'\n    compileOnly 'org.projectlombok:lombok'\n    annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'\n    annotationProcessor 'org.projectlombok:lombok'\n    implementation 'org.springframework.kafka:spring-kafka'\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"run-and-learn",children:"Run and learn"}),"\n",(0,i.jsx)(e.h3,{id:"consumer--partition-ho\u1ea1t-\u0111\u1ed9ng-v\u1edbi-nhau-nh\u01b0-th\u1ebf-n\xe0o-",children:"Consumer + partition ho\u1ea1t \u0111\u1ed9ng v\u1edbi nhau nh\u01b0 th\u1ebf n\xe0o ?"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Ch\xfang ta \u0111\xe3 t\u1ea1o \u0111\u01b0\u1ee3c topic v\u1edbi 10 partition"}),"\n",(0,i.jsxs)(e.li,{children:["V\u1edbi Consumer c\xf3 concurrency = 2, ngh\u0129a l\xe0 s\u1ebd c\xf3 2 consumer \u0111\u01b0\u1ee3c t\u1ea1o ra \u0111\u1ec3 consume message t\u1eeb topic1","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Check log ch\xfang ta s\u1ebd th\u1ea5y consume 1 s\u1ebd consume partition t\u1eeb 0 -> 4, consume 2 s\u1ebd consume partition t\u1eeb 5 -> 9"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"o.s.k.l.KafkaMessageListenerContainer    : myId: partitions assigned: [topic1-5, topic1-6, topic1-7, topic1-8, topic1-9]\no.s.k.l.KafkaMessageListenerContainer    : myId: partitions assigned: [topic1-0, topic1-1, topic1-2, topic1-3, topic1-4]\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"V\u1edbi Consumer c\xf3 concurrency = 1, ngh\u0129a l\xe0 ch\u1ec9 c\xf3 1 consumer duy nh\u1ea5t consume message t\u1eeb topic1, tr\xean c\u1ea3 10 partition"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"consumer-ack-tr\xean-t\u1eebng-partition-ho\u1ea1t-\u0111\u1ed9ng-nh\u01b0-th\u1ebf-n\xe0o-",children:"Consumer, ack tr\xean t\u1eebng partition ho\u1ea1t \u0111\u1ed9ng nh\u01b0 th\u1ebf n\xe0o ?"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Config producer b\u1eafn 10 messages tr\xean 1 partition"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Config consumer c\xf3 concurrency = 1"}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Ch\xfang ta s\u1ebd th\u1ea5y consumer s\u1ebd kh\xf4ng consume message ti\u1ebfp theo cho \u0111\u1ebfn khi message tr\u01b0\u1edbc \u0111\xf3 \u0111\u01b0\u1ee3c ack"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"C\xf3 th\u1ec3 t\u1ef1 config mode manual ack, v\xe0 kh\xf4ng ack message, b\u1ea1n s\u1ebd th\u1ea5y message \u0111\xf3 \u0111\u01b0\u1ee3c consume m\xe3i m\xe3i."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"M\u1ee5c \u0111\xedch:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"\u0111\u1ea3m b\u1ea3o t\xednh th\u1ee9 t\u1ef1 tr\xean t\u1eebng partition (producer c\xf3 th\u1ec3 truy\u1ec1n th\xeam key \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o v\u1edbi c\xf9ng 1 key, data s\u1ebd v\xe0o c\xf9ng 1 partition)"}),"\n",(0,i.jsx)(e.li,{children:"N\u1ebfu kh\xf4ng c\xf3 key, data v\xe0o partition n\xe0o s\u1ebd do broker quy\u1ebft \u0111\u1ecbnh."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"c\xe2u-h\u1ecfi-t\u1ef1-tr\u1ea3-l\u1eddi",children:"C\xe2u h\u1ecfi t\u1ef1 tr\u1ea3 l\u1eddi"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"1 partition c\xf3 2 consumer(set concurrency = 2) c\xf3 \u0111\u01b0\u1ee3c ko ?"}),"\n",(0,i.jsx)(e.li,{children:"config: auto.offset.reset = latest, earliest \u0111\u1ec3 l\xe0m g\xec ?"}),"\n",(0,i.jsx)(e.li,{children:"config: group-id \u0111\u1ec3 l\xe0m g\xec -> thay \u0111\u1ed5i gi\xe1 tr\u1ecb n\xe0y khi config"}),"\n",(0,i.jsx)(e.li,{children:"Kh\xf4ng d\xf9ng @KafkaListener, t\u1ef1 config t\u1eebng prop \u0111\u1ec3 hi\u1ec3u r\xf5 h\u01a1n v\u1ec1 consumer, v\xed d\u1ee5"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'Map<String, Object> props = new HashMap<>();\nprops.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");\nprops.put(ConsumerConfig.GROUP_ID_CONFIG, "group-id");\nprops.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\nprops.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\nprops.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, "latest");\n'})}),"\n",(0,i.jsx)(e.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://docs.spring.io/spring-kafka/reference/quick-tour.html",children:"https://docs.spring.io/spring-kafka/reference/quick-tour.html"})}),"\n"]})]})}function d(n={}){const{wrapper:e}={...(0,o.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(p,{...n})}):p(n)}},1151:(n,e,r)=>{r.d(e,{Z:()=>s,a:()=>t});var i=r(7294);const o={},a=i.createContext(o);function t(n){const e=i.useContext(a);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:t(n.components),i.createElement(a.Provider,{value:e},n.children)}}}]);